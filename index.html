<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>বোতল ফ্লিপ - প্রিমিয়াম এডিশন</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        margin:0; overflow:hidden; font-family:'Segoe UI',sans-serif;
        background:linear-gradient(#2e7d32,#1b5e20); height:100vh;
        user-select:none; -webkit-user-select:none; touch-action:manipulation;
    }
    canvas { display:block; }
    
    /* UI */
    #ui { position:absolute; inset:0; pointer-events:none; color:white; }
    #top-bar {
        display:flex; justify-content:space-between; align-items:center;
        padding:15px 20px; background:rgba(0,0,0,0.25); backdrop-filter:blur(10px);
    }
    .stat {
        display:flex; align-items:center; background:rgba(255,255,255,0.2);
        padding:8px 18px; border-radius:50px; font-weight:bold; font-size:1.4rem;
        backdrop-filter:blur(8px); pointer-events:all;
    }
    .stat img { width:36px; height:36px; margin-right:8px; }
    #pause-btn {
        width:50px; height:50px; background:rgba(255,255,255,0.25);
        border-radius:50%; display:grid; place-items:center; font-size:1.8rem;
        pointer-events:all;
    }
    #progress-container {
        position:absolute; top:90px; left:20px; right:20px; height:30px;
        background:rgba(0,0,0,0.3); border-radius:20px; overflow:hidden;
        pointer-events:none;
    }
    #progress {
        height:100%; width:100%; background:linear-gradient(90deg,#ffb300,#ff6d00);
        border-radius:20px; transition:width 0.4s ease;
    }

    /* Screens */
    .screen {
        position:absolute; inset:0; background:rgba(0,0,0,0.8);
        display:flex; flex-direction:column; justify-content:center; align-items:center;
        color:white; text-align:center;
    }
    h1 { font-size:4rem; margin-bottom:20px; color:#ffeb3b; text-shadow:0 5px 10px #000; }
    button {
        padding:18px 60px; margin:15px; font-size:2rem; background:#e91e63;
        color:white; border:none; border-radius:50px; cursor:pointer;
        box-shadow:0 8px 0 #ad1457; transition:0.2s;
    }
    button:active { transform:translateY(8px); box-shadow:none; }
    .hidden { display:none; }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
    <div id="top-bar">
        <div class="stat">
            <img src="https://i.imgur.com/v8pE8V5.png"> <span id="coins">1000</span>
        </div>
        <div class="stat">
            <img src="https://i.imgur.com/tH3f8c5.png"> <span id="lives">3</span>
        </div>
        <div class="stat">
            <img src="https://i.imgur.com/8qQ3Y3a.png"> <span id="level">1</span>
        </div>
        <div id="pause-btn">II</div>
    </div>

    <div id="progress-container">
        <div id="progress"></div>
    </div>
</div>

<!-- Screens -->
<div id="start-screen" class="screen">
    <h1>বোতল ফ্লিপ</h1>
    <button id="play-btn">খেলা শুরু</button>
</div>

<div id="gameover-screen" class="screen hidden">
    <h1>গেম ওভার!</h1>
    <p style="font-size:2rem;">তোমার স্কোর: <span id="final-score">0</span></p>
    <button id="restart-btn">আবার খেলো</button>
</div>

<audio id="flip" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
<audio id="land" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>
<audio id="perfect" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
<audio id="fail" src="https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2043.mp3"></audio>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = Math.min(window.innerWidth, 500);
canvas.height = window.innerHeight;

let score = 0, lives = 3, level = 1, coins = 1000;
let bottle, platforms = [], currentPlatform;
let dragging = false, startX, startY;
let gameActive = false;

// বোতল ক্লাস
class Bottle {
    constructor() { this.reset(); }
    reset() {
        this.w = 40; this.h = 100;
        this.x = currentPlatform.x + currentPlatform.w/2 - 20;
        this.y = currentPlatform.y - this.h;
        this.vx = this.vy = this.rot = this.rotSpeed = 0;
        this.flipping = false;
    }
    draw() {
        ctx.save();
        ctx.translate(this.x + 20, this.y + 50);
        ctx.rotate(this.rot * Math.PI / 180);

        // বোতল বডি
        ctx.fillStyle = '#d32f2f';
        ctx.roundRect(-20, -50, 40, 100, 20).fill();
        ctx.fillStyle = '#b71c1c';
        ctx.roundRect(-16, -40, 32, 80, 16).fill();

        // ক্যাপ
        ctx.fillStyle = '#424242';
        ctx.fillRect(-14, -58, 28, 15);

        // লেবেল
        ctx.fillStyle = '#fff';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Cola', 0, 10);

        ctx.restore();
    }
    update() {
        if (!this.flipping) return;
        this.vy += 0.5;
        this.x += this.vx;
        this.y += this.vy;
        this.rot += this.rotSpeed;
    }
    launch(angle, power) {
        this.flipping = true;
        this.vx = Math.cos(angle) * power * 0.2;
        this.vy = Math.sin(angle) * power * 0.2 - 3;
        this.rotSpeed = power * 0.18 * (this.vx > 0 ? -1 : 1);
        play('flip');
    }
}

// প্ল্যাটফর্ম
class Platform {
    constructor(x, y, w, type='normal') {
        this.x = x; this.y = y; this.w = w; this.h = 30; this.type = type;
    }
    draw() {
        // টেবিল/শেল্ফ
        ctx.fillStyle = '#6d4c41';
        ctx.fillRect(this.x, this.y, this.w, this.h);
        ctx.fillStyle = '#4e342e';
        ctx.fillRect(this.x+5, this.y+5, this.w-10, this.h-10);

        // ডেকোরেশন
        if (this.type === 'shelf') {
            // ফুলদানি
            ctx.fillStyle = '#fff';
            ctx.fillRect(this.x + this.w - 50, this.y - 50, 40, 50);
            ctx.fillStyle = '#e91e63';
            ctx.beginPath();
            for(let i=0;i<3;i++){
                ctx.arc(this.x+this.w-30 + i*15, this.y-60, 12,0,Math.PI*2);
                ctx.fill();
            }
        }
        if (this.type === 'clock') {
            ctx.fillStyle = '#ffeb3b';
            ctx.beginPath();
            ctx.arc(this.x + this.w/2, this.y - 40, 50, 0, Math.PI*2);
            ctx.fill();
            ctx.strokeStyle = '#000'; ctx.lineWidth = 5;
            ctx.beginPath(); ctx.moveTo(this.x+this.w/2, this.y-40);
            ctx.lineTo(this.x+this.w/2, this.y-70); ctx.stroke();
        }
    }
}

function initLevel() {
    platforms = [];
    // প্রথম টেবিল
    platforms.push(new Platform(60, canvas.height - 100, 200, 'table'));
    // পরের প্ল্যাটফর্ম
    let lastY = canvas.height - 100;
    for(let i = 1; i < 30; i++) {
        lastY -= 140 + Math.random()*60;
        const w = 120 + Math.random()*100;
        const x = 30 + Math.random()*(canvas.width - w - 60);
        const type = i%5===0 ? 'clock' : (i%3===0 ? 'shelf' : 'normal');
        platforms.push(new Platform(x, lastY, w, type));
    }
    currentPlatform = platforms[0];
    bottle = new Bottle();
}

function drawBackground() {
    // গ্রীন ওয়াল
    const grad = ctx.createLinearGradient(0,0,0,canvas.height);
    grad.addColorStop(0, '#81c784');
    grad.addColorStop(1, '#4caf50');
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // উইন্ডো
    ctx.fillStyle = '#e3f2fd';
    ctx.fillRect(30, 80, 120, 180);
    ctx.fillStyle = '#90caf9';
    ctx.fillRect(40, 90, 100, 160);
    ctx.strokeStyle = '#fff'; ctx.lineWidth = 8;
    ctx.strokeRect(40,170,140,170);

    // আরেকটা উইন্ডো
    ctx.fillStyle = '#e3f2fd';
    ctx.fillRect(canvas.width-150, 100, 100, 150);
    ctx.fillStyle = '#90caf9';
    ctx.fillRect(canvas.width-140, 110, 80, 130);
}

function play(id) {
    const audio = document.getElementById(id);
    audio.currentTime = 0;
    audio.play().catch(()=>{});
}

function checkLanding() {
    if (!bottle.flipping || bottle.vy <= 0) return false;
    for(let i = platforms.indexOf(currentPlatform)+1; i<platforms.length; i++) {
        const p = platforms[i];
        if (bottle.y + bottle.h > p.y && bottle.y < p.y) {
            if (bottle.x + 20 > p.x && bottle.x + 20 < p.x + p.w) {
                const angle = Math.abs(bottle.rot % 360);
                const perfect = angle < 25 || angle > 335;
                bottle.flipping = false;
                currentPlatform = p;
                bottle.x = p.x + p.w/2 - 20;
                bottle.y = p.y - bottle.h;
                bottle.rot = 0; bottle.vx = bottle.vy = bottle.rotSpeed = 0;

                if (perfect) {
                    score += 50;
                    coins += 20;
                    play('perfect');
                } else {
                    score += 10;
                    coins += 5;
                    play('land');
                }
                level = platforms.indexOf(p);
                document.getElementById('level').textContent = level;
                document.getElementById('coins').textContent = coins;
                document.getElementById('progress.style.width = `${level*3.5}%`;
                return true;
            }
        }
    }
    return false;
}

function gameLoop() {
    if (!gameActive) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBackground();
    platforms.forEach(p => p.draw());
    bottle.draw();
    bottle.update();

    if (bottle.flipping) {
        if (!checkLanding() && bottle.y > canvas.height + 100) {
            lives--;
            document.getElementById('lives').textContent = lives;
            play('fail');
            if (lives <= 0) {
                gameActive = false;
                document.getElementById('final-score').textContent = score;
                document.getElementById('gameover-screen').classList.remove('hidden');
            } else {
                bottle.reset();
            }
        }
    }

    // ট্র্যাজেক্টরি লাইন
    if (dragging) {
        ctx.strokeStyle = 'rgba(255,255,255,0.7)';
        ctx.lineWidth = 6;
        ctx.setLineDash([10,15]);
        ctx.beginPath();
        ctx.moveTo(bottle.x+20, bottle.y+50);
        ctx.lineTo(startX, startY);
        ctx.stroke();
        ctx.setLineDash([]);
    }

    requestAnimationFrame(gameLoop);
}

// কন্ট্রোল
canvas.addEventListener('pointerdown', e => {
    if (!gameActive || bottle.flipping) return;
    dragging = true;
    startX = e.clientX;
    startY = e.clientY;
});
canvas.addEventListener('pointermove', e => {
    if (dragging) {
        e.preventDefault();
    }
});
canvas.addEventListener('pointerup', e => {
    if (!dragging) return;
    dragging = false;
    const dx = startX - e.clientX;
    const dy = startY - e.clientY;
    const dist = Math.min(Math.hypot(dx,dy), 200);
    if (dist > 30) {
        const angle = Math.atan2(dy, dx);
        bottle.launch(angle, dist);
    }
});

// বাটন
document.getElementById('play-btn').onclick = () => {
    score = 0; lives = 3; level = 1; coins = 1000;
    document.getElementById('coins.textContent = coins;
    document.getElementById('lives').textContent = lives;
    document.getElementById('level').textContent = level;
    document.getElementById('progress').style.width = '0%';
    document.getElementById('start-screen').classList.add('hidden');
    initLevel();
    gameActive = true;
    gameLoop();
};
document.getElementById('restart-btn').onclick = () => location.reload();
document.getElementById('pause-btn').onclick = () => alert('পজ করতে চাইলে ব্যাক বাটন চাপুন');

// Canvas roundRect helper
CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r) {
    this.beginPath();
    this.moveTo(x+r, y);
    this.arcTo(x+w, y, x+w, y+h, r);
    this.arcTo(x+w, y+h, x, y+h, r);
    this.arcTo(x, y+h, x, y, r);
    this.arcTo(x, y, x+w, y, r);
    this.closePath();
    return this;
};

// শুরু
initLevel();
</script>
</body>
</html>
