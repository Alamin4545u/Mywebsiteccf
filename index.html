<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Earn BD</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Supabase Script -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- SweetAlert2 for Popups -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary: #6C5CE7;
            --secondary: #00CEC9;
            --bg-color: #dfe6e9;
            --text-color: #2d3436;
            --card-bg: #ffffff;
            --shadow-light: rgba(255, 255, 255, 0.5);
            --shadow-dark: rgba(0, 0, 0, 0.15);
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            overflow-x: hidden;
        }

        /* --- Header 3D --- */
        .header {
            background: linear-gradient(135deg, #6C5CE7, #a29bfe);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom-left-radius: 25px;
            border-bottom-right-radius: 25px;
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.3);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid white; }
        .user-name { font-weight: 700; font-size: 1rem; }
        
        .balance-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.3);
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .balance-box:active { transform: scale(0.95); }
        .coin-icon { color: #FFD700; font-size: 1.2rem; text-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* --- Main Container --- */
        .container { padding: 20px; padding-bottom: 80px; }

        /* --- Gigapub Ads Placeholder --- */
        .ad-banner {
            width: 100%;
            height: 100px;
            background: #f1f2f6;
            border-radius: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px dashed #b2bec3;
            color: #636e72;
            font-size: 0.9rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }

        /* --- Section Title --- */
        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2d3436;
            border-left: 5px solid var(--primary);
            padding-left: 10px;
        }

        /* --- 3D Grid Layout --- */
        .quiz-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .quiz-card {
            height: 120px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            transition: all 0.1s;
            /* 3D Effect */
            transform: translateY(0);
            box-shadow: 0 6px 0 rgba(0,0,0,0.2), 0 10px 10px rgba(0,0,0,0.1);
        }

        .quiz-card:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 rgba(0,0,0,0.2), inset 0 0 5px rgba(0,0,0,0.1);
        }

        .quiz-card i { font-size: 2rem; margin-bottom: 5px; }
        .quiz-card span { font-size: 0.9rem; }

        /* Colors specific to cards */
        .bg-bd { background: linear-gradient(135deg, #00b894, #00cec9); border-bottom: 6px solid #008b70; }
        .bg-int { background: linear-gradient(135deg, #0984e3, #74b9ff); border-bottom: 6px solid #065fa3; }
        .bg-gk { background: linear-gradient(135deg, #fdcb6e, #e17055); border-bottom: 6px solid #d35400; }
        .bg-isl { background: linear-gradient(135deg, #2ecc71, #27ae60); border-bottom: 6px solid #1e8449; }

        /* --- Spin Wheel Section --- */
        .spin-section {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .wheel-container {
            width: 250px;
            height: 250px;
            margin: 0 auto 20px auto;
            position: relative;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #6C5CE7;
            background: conic-gradient(
                #ff7675 0deg 60deg,
                #74b9ff 60deg 120deg,
                #55efc4 120deg 180deg,
                #ffeaa7 180deg 240deg,
                #a29bfe 240deg 300deg,
                #fd79a8 300deg 360deg
            );
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .wheel-arrow {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #2d3436;
            z-index: 10;
        }

        .spin-btn {
            background: linear-gradient(135deg, #e84393, #d63031);
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #b71540;
            transition: all 0.1s;
        }
        .spin-btn:active { transform: translateY(5px); box-shadow: none; }

        /* --- Modals (Hidden by default) --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            position: relative;
            animation: popup 0.3s ease-out;
        }
        @keyframes popup { from{transform: scale(0.5); opacity: 0;} to{transform: scale(1); opacity: 1;} }

        .close-btn {
            position: absolute; top: 10px; right: 15px; font-size: 25px; cursor: pointer; color: #636e72;
        }

        /* Quiz UI in Modal */
        .option-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #f1f2f6;
            border: 2px solid #dfe6e9;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            color: #2d3436;
            cursor: pointer;
        }
        .option-btn.correct { background: #55efc4; color: white; border-color: #00b894; }
        .option-btn.wrong { background: #ff7675; color: white; border-color: #d63031; }

        /* Withdraw UI */
        .withdraw-input {
            width: 100%; padding: 10px; margin: 10px 0;
            border: 2px solid #ddd; border-radius: 10px; font-family: inherit;
        }
        .withdraw-btn {
            background: var(--primary); color: white; width: 100%; padding: 12px;
            border: none; border-radius: 10px; font-weight: bold; margin-top: 10px;
        }

    </style>
</head>
<body>

    <!-- Header -->
    <div class="header">
        <div class="user-info">
            <img src="https://via.placeholder.com/40" alt="User" class="user-avatar" id="userAvatar">
            <div>
                <div class="user-name" id="userName">লোড হচ্ছে...</div>
                <div style="font-size: 0.7rem; opacity: 0.8;">আইডি: <span id="userId">...</span></div>
            </div>
        </div>
        <div class="balance-box" onclick="openWithdrawModal()">
            <i class="fas fa-coins coin-icon"></i>
            <span id="userBalance" style="font-weight: 700; font-size: 1.1rem;">0</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        
        <!-- Gigapub Ad Banner -->
        <div class="ad-banner" id="ad-container-top">
            <!-- এখানে Gigapub এর স্ক্রিপ্ট বসাবেন -->
            <i class="fas fa-ad"></i> &nbsp; বিজ্ঞাপন (Gigapub Ads)
        </div>

        <!-- Quiz Section -->
        <div class="section-title">কুইজ খেলুন এবং আয় করুন</div>
        <div class="quiz-grid">
            <div class="quiz-card bg-bd" onclick="startQuiz('bangladesh')">
                <i class="fas fa-flag"></i>
                <span>বাংলাদেশ</span>
            </div>
            <div class="quiz-card bg-int" onclick="startQuiz('international')">
                <i class="fas fa-globe-americas"></i>
                <span>আন্তর্জাতিক</span>
            </div>
            <div class="quiz-card bg-gk" onclick="startQuiz('gk')">
                <i class="fas fa-brain"></i>
                <span>সাধারণ জ্ঞান</span>
            </div>
            <div class="quiz-card bg-isl" onclick="startQuiz('islamic')">
                <i class="fas fa-mosque"></i>
                <span>ইসলামিক</span>
            </div>
        </div>

        <!-- Spin Section -->
        <div class="section-title">লাকি স্পিন</div>
        <div class="spin-section">
            <div class="wheel-container">
                <div class="wheel-arrow"></div>
                <div class="wheel" id="wheel"></div>
            </div>
            <button class="spin-btn" id="spinBtn" onclick="spinWheel()">স্পিন করুন</button>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('quizModal')">&times;</span>
            <h3 id="questionText">প্রশ্ন লোড হচ্ছে...</h3>
            <div id="optionsContainer"></div>
            <div style="margin-top: 15px; font-size: 0.9rem; color: #636e72;">
                প্রশ্ন: <span id="qCurrent">1</span>/<span id="qTotal">10</span>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('withdrawModal')">&times;</span>
            <h3>টাকা উত্তোলন</h3>
            <p>আপনার বর্তমান ব্যালেন্স: <span id="modalBalance" style="color: var(--primary); font-weight:bold;">0</span></p>
            
            <select class="withdraw-input" id="withdrawMethod">
                <option value="bkash">বিকাশ</option>
                <option value="nagad">নগদ</option>
                <option value="rocket">রকেট</option>
                <option value="recharge">মোবাইল রিচার্জ</option>
            </select>
            <input type="number" class="withdraw-input" id="withdrawAmount" placeholder="পরিমাণ (নূন্যতম ৫০)">
            <input type="text" class="withdraw-input" id="withdrawNumber" placeholder="মোবাইল নাম্বার">
            
            <button class="withdraw-btn" onclick="submitWithdraw()">রিকোয়েস্ট পাঠান</button>
        </div>
    </div>

    <script>
        // --- কনফিগারেশন (এডমিন প্যানেল থেকে যা কন্ট্রোল করবেন তা ডাটাবেস থেকে আনা হবে) ---
        const CONFIG = {
            quizReward: 10,      // প্রতিটি সঠিক উত্তরের জন্য পয়েন্ট
            spinCost: 0,         // স্পিন করতে খরচ (যদি থাকে)
            questionsPerQuiz: 5  // প্রতি সেশনে কয়টি প্রশ্ন
        };

        // --- Supabase সেটআপ (আপনার KEY এখানে দিন) ---
        // রিয়েল লাইফে এই কি গুলো সার্ভারে বা এনভায়রনমেন্ট ভেরিয়েবলে থাকে, কিন্তু ক্লায়েন্ট সাইড ডেমোর জন্য এখানে দেওয়া হলো।
        const supabaseUrl = 'আপনার_SUPABASE_URL_এখানে_দিন';
        const supabaseKey = 'আপনার_SUPABASE_ANON_KEY_এখানে_দিন';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // --- টেলিগ্রাম ইউজার ডাটা ---
        const tg = window.Telegram.WebApp;
        tg.expand();

        // টেস্টিং এর জন্য ফেইক ইউজার ডাটা (যদি টেলিগ্রামের বাইরে ওপেন করেন)
        let user = tg.initDataUnsafe.user || {
            id: 123456,
            first_name: "Guest",
            last_name: "User",
            username: "guest_user"
        };

        // --- স্টেট ভেরিয়েবল ---
        let currentBalance = 0;
        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let score = 0;

        // --- ডাটাবেস থেকে ইউজার লোড বা ক্রিয়েট করা ---
        async function initUser() {
            // UI আপডেট
            document.getElementById('userName').innerText = user.first_name;
            document.getElementById('userId').innerText = user.id;
            // প্রোফাইল পিকচার না থাকলে ডিফল্ট
            if(user.photo_url) document.getElementById('userAvatar').src = user.photo_url;

            // Supabase কল (ডেমো লজিক)
            /* 
            প্রোডাকশনে নিচের কোডটি আনকমেন্ট করবেন যখন Supabase সেটআপ কমপ্লিট হবে:
            
            const { data, error } = await supabase
                .from('users')
                .select('*')
                .eq('telegram_id', user.id)
                .single();

            if (!data) {
                await supabase.from('users').insert([{ telegram_id: user.id, name: user.first_name, balance: 0 }]);
                currentBalance = 0;
            } else {
                currentBalance = data.balance;
            }
            */
           
            // টেস্টিং এর জন্য লোকাল স্টোরেজ ব্যবহার করছি
            const savedBalance = localStorage.getItem('balance_' + user.id);
            currentBalance = savedBalance ? parseInt(savedBalance) : 0;
            updateBalanceUI();
        }

        function updateBalanceUI() {
            document.getElementById('userBalance').innerText = currentBalance;
            document.getElementById('modalBalance').innerText = currentBalance;
            localStorage.setItem('balance_' + user.id, currentBalance); // টেস্টিং সেভ
        }

        async function addBalance(amount) {
            currentBalance += amount;
            updateBalanceUI();
            
            // Supabase Update Code
            /*
            await supabase.from('users').update({ balance: currentBalance }).eq('telegram_id', user.id);
            */
        }

        // --- কুইজ ডাটা (মক ডাটাবেস) ---
        const quizData = {
            bangladesh: [
                { q: "বাংলাদেশের জাতীয় প্রতীক কী?", options: ["শাপলা", "রয়েল বেঙ্গল টাইগার", "দোয়েল", "ইলিশ"], ans: 0 },
                { q: "বিজয় দিবস কবে?", options: ["২১ ফেব্রুয়ারি", "২৬ মার্চ", "১৬ ডিসেম্বর", "১৪ এপ্রিল"], ans: 2 },
                { q: "বাংলাদেশের রাজধানী কোথায়?", options: ["চট্টগ্রাম", "খুলনা", "ঢাকা", "সিলেট"], ans: 2 },
                { q: "পদ্মা সেতুর দৈর্ঘ্য কত?", options: ["৬.১৫ কিমি", "৫.৫০ কিমি", "৪.৮০ কিমি", "৭.০০ কিমি"], ans: 0 },
                { q: "জাতীয় কবি কে?", options: ["রবীন্দ্রনাথ ঠাকুর", "কাজী নজরুল ইসলাম", "জসীমউদ্দীন", "জীবনানন্দ দাশ"], ans: 1 }
            ],
            international: [
                { q: "বিশ্বের সবচেয়ে বড় দেশ কোনটি?", options: ["চীন", "আমেরিকা", "রাশিয়া", "কানাডা"], ans: 2 },
                { q: "ফেসবুকের প্রতিষ্ঠাতা কে?", options: ["বিল গেটস", "মার্ক জাকারবার্গ", "এলন মাস্ক", "স্টিভ জবস"], ans: 1 }
            ],
            gk: [
                { q: "মানবদেহে হাড়ের সংখ্যা কত?", options: ["২০৬", "৩০৬", "১০৬", "২০৮"], ans: 0 }
            ],
            islamic: [
                { q: "কুরআনের মোট সূরা কয়টি?", options: ["১১০", "১১৪", "১২০", "১০০"], ans: 1 }
            ]
        };

        // --- কুইজ ফাংশনালিটি ---
        function startQuiz(category) {
            // ডাটাবেস থেকে প্রশ্ন আনার লজিক এখানে বসবে
            // আপাতত লোকাল অ্যারে থেকে নেওয়া হচ্ছে
            let allQuestions = quizData[category] || quizData['bangladesh']; // ফলব্যাক
            
            // র‍্যান্ডম প্রশ্ন বাছাই
            currentQuiz = allQuestions.sort(() => 0.5 - Math.random()).slice(0, CONFIG.questionsPerQuiz);
            
            if(currentQuiz.length === 0) {
                Swal.fire('দুঃখিত', 'এই ক্যাটাগরিতে বর্তমানে প্রশ্ন নেই।', 'info');
                return;
            }

            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('quizModal').style.display = "flex";
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= currentQuiz.length) {
                endQuiz();
                return;
            }
            
            const q = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').innerText = q.q;
            document.getElementById('qCurrent').innerText = currentQuestionIndex + 1;
            document.getElementById('qTotal').innerText = currentQuiz.length;

            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';

            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(index, q.ans, btn);
                container.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btnElement) {
            // বাটনগুলো ডিজেবল করা যাতে একাধিক ক্লিক না হয়
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);

            if (selected === correct) {
                btnElement.classList.add('correct');
                score++;
            } else {
                btnElement.classList.add('wrong');
                // সঠিক উত্তর দেখিয়ে দেওয়া
                btns[correct].classList.add('correct');
            }

            setTimeout(() => {
                currentQuestionIndex++;
                loadQuestion();
            }, 1000);
        }

        function endQuiz() {
            closeModal('quizModal');
            const earnedPoints = score * CONFIG.quizReward;
            addBalance(earnedPoints);
            
            Swal.fire({
                title: 'অভিনন্দন!',
                text: `আপনি ${currentQuiz.length} টির মধ্যে ${score} টি সঠিক উত্তর দিয়েছেন। মোট আয়: ${earnedPoints} কয়েন।`,
                icon: 'success',
                confirmButtonText: 'ঠিক আছে'
            });
            
            // এখানে অ্যাড শো করা যেতে পারে (Gigapub Interstitial)
        }

        // --- স্পিন হুইল ফাংশনালিটি ---
        let spinning = false;
        function spinWheel() {
            if (spinning) return;
            spinning = true;

            const wheel = document.getElementById('wheel');
            // র‍্যান্ডম রোটেশন (3600 ডিগ্রি মানে ১০ বার ঘোরা + র‍্যান্ডম পজিশন)
            const randomDeg = Math.floor(5000 + Math.random() * 5000); 
            
            wheel.style.transform = `rotate(${randomDeg}deg)`;

            setTimeout(() => {
                spinning = false;
                // পয়েন্ট ক্যালকুলেশন (ডেমো: র‍্যান্ডম ৫-৫০ কয়েন)
                const points = Math.floor(Math.random() * 50) + 5;
                addBalance(points);
                
                Swal.fire({
                    title: 'ওয়াও!',
                    text: `আপনি জিতেছেন ${points} কয়েন!`,
                    icon: 'success'
                });
                
                // পরের স্পিনের জন্য রিসেট (transition ছাড়া)
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${randomDeg % 360}deg)`;
                setTimeout(() => { wheel.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)'; }, 50);

            }, 4000); // ৪ সেকেন্ড পর রেজাল্ট
        }

        // --- উইথড্রয়াল ফাংশনালিটি ---
        function openWithdrawModal() {
            document.getElementById('withdrawModal').style.display = "flex";
            document.getElementById('modalBalance').innerText = currentBalance;
        }

        async function submitWithdraw() {
            const method = document.getElementById('withdrawMethod').value;
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const number = document.getElementById('withdrawNumber').value;

            if (!amount || !number || amount < 50) {
                Swal.fire('ত্রুটি', 'মিনিমাম ৫০ কয়েন এবং সঠিক নাম্বার দিন।', 'error');
                return;
            }

            if (amount > currentBalance) {
                Swal.fire('ত্রুটি', 'আপনার পর্যাপ্ত ব্যালেন্স নেই।', 'error');
                return;
            }

            // ব্যালেন্স কমানো
            addBalance(-amount);

            // Supabase এ রিকোয়েস্ট পাঠানো
            /*
            const { error } = await supabase
                .from('withdrawals')
                .insert([{ user_id: user.id, method: method, amount: amount, number: number, status: 'pending' }]);
            */
           
            closeModal('withdrawModal');
            Swal.fire('সফল', 'আপনার উইথড্র রিকোয়েস্ট এডমিনের কাছে পাঠানো হয়েছে।', 'success');
        }

        // --- ইউটিলিটি ---
        function closeModal(id) {
            document.getElementById(id).style.display = "none";
        }

        // অ্যাপ লোড হলে
        window.onload = initUser;

    </script>
</body>
</html>
